{"version":3,"sources":["controls/filePicker/RecentFilesTab/RecentFilesTab.tsx"],"names":[],"mappings":"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","file":"controls/filePicker/RecentFilesTab/RecentFilesTab.js","sourcesContent":["import * as React from 'react';\r\n\r\nimport { PrimaryButton, DefaultButton } from 'office-ui-fabric-react/lib/components/Button';\r\nimport { Spinner } from 'office-ui-fabric-react/lib/Spinner';\r\nimport { FocusZone } from 'office-ui-fabric-react/lib/FocusZone';\r\nimport { List } from 'office-ui-fabric-react/lib/List';\r\nimport { IRectangle } from 'office-ui-fabric-react/lib/Utilities';\r\nimport { css } from \"@uifabric/utilities/lib/css\";\r\nimport { Selection, SelectionMode, SelectionZone } from 'office-ui-fabric-react/lib/Selection';\r\nimport { Image, ImageFit } from 'office-ui-fabric-react/lib/Image';\r\nimport { Check } from 'office-ui-fabric-react/lib/Check';\r\nimport { Placeholder } from '../../../Placeholder';\r\nimport { IRecentFile } from '../../../services/FilesSearchService.types';\r\nimport { IFilePickerResult } from '../FilePicker.types';\r\nimport { GeneralHelper } from '../../../Utilities';\r\nimport { IRecentFilesTabProps, IRecentFilesTabState } from '.';\r\n\r\nimport * as strings from 'ControlStrings';\r\nimport styles from './RecentFilesTab.module.scss';\r\n\r\n/**\r\n * Rows per page\r\n */\r\nconst ROWS_PER_PAGE = 3;\r\n\r\n/**\r\n * Maximum row height\r\n */\r\nconst MAX_ROW_HEIGHT = 250;\r\n\r\nexport default class RecentFilesTab extends React.Component<IRecentFilesTabProps, IRecentFilesTabState> {\r\n  private _columnCount: number;\r\n  private _columnWidth: number;\r\n  private _rowHeight: number;\r\n  private _selection: Selection;\r\n  private _listElem: List = undefined;\r\n\r\n  constructor(props: IRecentFilesTabProps) {\r\n    super(props);\r\n\r\n    this._selection = new Selection({\r\n      selectionMode: SelectionMode.single,\r\n      onSelectionChanged: this._onSelectionChanged\r\n    });\r\n\r\n\r\n    this.state = {\r\n      isLoading: true,\r\n      results: [],\r\n      filePickerResult: null\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets the most recently used files\r\n   */\r\n  public async componentDidMount() {\r\n    const recentFilesResult = await this.props.fileSearchService.executeRecentSearch(this.props.accepts);\r\n    this._selection.setItems(recentFilesResult, true);\r\n\r\n    this.setState({\r\n      isLoading: false,\r\n      results: recentFilesResult\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Render the tab\r\n   */\r\n  public render(): React.ReactElement<IRecentFilesTabProps> {\r\n    const { results,\r\n      isLoading } = this.state;\r\n    return (\r\n      <span className={styles.tabContainer}>\r\n        <span className={styles.tabHeaderContainer}>\r\n          <h2 className={styles.tabHeader}>{strings.RecentDocumentsHeader}</h2>\r\n        </span>\r\n        <span className={styles.tab}>\r\n          {isLoading ?\r\n            this._renderSpinner() :\r\n            results === undefined || results.length < 1 ? this._renderPlaceholder() : this._renderGridList()\r\n          }\r\n        </span>\r\n        <span className={styles.actionButtonsContainer}>\r\n          <span className={styles.actionButtons}>\r\n            <PrimaryButton\r\n              disabled={!this.state.filePickerResult}\r\n              onClick={() => this._handleSave()}\r\n              className={styles.actionButton}\r\n            >{strings.OpenButtonLabel}</PrimaryButton>\r\n            <DefaultButton onClick={() => this._handleClose()} className={styles.actionButton}>{strings.CancelButtonLabel}</DefaultButton>\r\n          </span>\r\n        </span>\r\n      </span>\r\n    );\r\n  }\r\n\r\n  private _onSelectionChanged = () => {\r\n    // Get the selected item\r\n    const selectedItems = this._selection.getSelection();\r\n    if (selectedItems && selectedItems.length > 0) {\r\n      //Get the selected key\r\n      const selectedKey: IRecentFile = selectedItems[0] as IRecentFile;\r\n      const filePickerResult: IFilePickerResult = {\r\n        fileAbsoluteUrl: selectedKey.fileUrl,\r\n        fileName: GeneralHelper.getFileNameFromUrl(selectedKey.fileUrl),\r\n        fileNameWithoutExtension: GeneralHelper.getFileNameWithoutExtension(selectedKey.fileUrl),\r\n        downloadFileContent: () => { return this.props.fileSearchService.downloadSPFileContent(selectedKey.fileUrl, GeneralHelper.getFileNameFromUrl(selectedKey.fileUrl)); }\r\n      };\r\n\r\n      // Save the selected file\r\n      this.setState({\r\n        filePickerResult\r\n      });\r\n    } else {\r\n      // Remove any selected file\r\n      this.setState({\r\n        filePickerResult: undefined\r\n      });\r\n    }\r\n    if (this._listElem) {\r\n      // Force the list to update to show the selection check\r\n      this._listElem.forceUpdate();\r\n    }\r\n  }\r\n\r\n  /**\r\n     * Calculates how many items there should be in the page\r\n     */\r\n  private _getItemCountForPage = (itemIndex: number, surfaceRect: IRectangle): number => {\r\n    if (itemIndex === 0) {\r\n      this._columnCount = Math.ceil(surfaceRect.width / MAX_ROW_HEIGHT);\r\n      this._columnWidth = Math.floor(surfaceRect.width / this._columnCount);\r\n      this._rowHeight = this._columnWidth;\r\n    }\r\n\r\n    return this._columnCount * ROWS_PER_PAGE;\r\n  }\r\n\r\n  /** Calculates the list \"page\" height (a.k.a. row) */\r\n  private _getPageHeight = (): number => {\r\n    return this._rowHeight * ROWS_PER_PAGE;\r\n  }\r\n\r\n\r\n  /**\r\n   * Renders a \"please wait\" spinner while we're loading\r\n   */\r\n  private _renderSpinner = (): JSX.Element => {\r\n    return <Spinner label={strings.Loading} />;\r\n  }\r\n\r\n  /**\r\n   * Renders a message saying that there are no recent files\r\n   */\r\n  private _renderPlaceholder = (): JSX.Element => {\r\n    return <Placeholder iconName='OpenFolderHorizontal'\r\n      iconText={strings.NoRecentFiles}\r\n      description={strings.NoRecentFilesDescription}\r\n    />;\r\n  }\r\n\r\n  /**\r\n   * Renders a grid list containing results\r\n   */\r\n  private _renderGridList = (): JSX.Element => {\r\n    return <span className={styles.recentGridList} role=\"grid\">\r\n      <FocusZone>\r\n        <SelectionZone selection={this._selection}\r\n          onItemInvoked={(item: IRecentFile) => this._handleItemInvoked(item)}>\r\n          <List\r\n            ref={this._linkElement}\r\n            items={this.state.results}\r\n            onRenderCell={this._onRenderCell}\r\n            getItemCountForPage={this._getItemCountForPage}\r\n            getPageHeight={this._getPageHeight}\r\n            renderedWindowsAhead={4}\r\n          />\r\n        </SelectionZone>\r\n      </FocusZone>\r\n    </span>;\r\n  }\r\n\r\n  /**\r\n   * Renders each result in its own cell\r\n   */\r\n  private _onRenderCell = (item: IRecentFile, index: number | undefined): JSX.Element => {\r\n    let isSelected: boolean = false;\r\n\r\n    if (this._selection && index !== undefined) {\r\n      isSelected = this._selection.isIndexSelected(index);\r\n    }\r\n\r\n    return (\r\n      <div\r\n        className={styles.gridListCell} role={\"gridCell\"}>\r\n        <div\r\n          className={css(styles.itemTile, styles.isFile, styles.hasThumbnail, isSelected ? styles.isSelected : undefined)}\r\n          role=\"link\"\r\n          aria-selected={isSelected}\r\n          data-is-draggable=\"false\"\r\n          data-is-focusable=\"true\"\r\n          data-selection-index={index}\r\n          data-selection-invoke=\"true\"\r\n          data-item-index={index}\r\n          data-automationid=\"ItemTile\"\r\n          style={{\r\n            width: this._columnWidth,\r\n            height: this._rowHeight\r\n          }}\r\n        >\r\n          <div className={styles.itemTileContent}>\r\n            <div className={styles.itemTileFile}>\r\n              <div className={styles.itemTileFileContainer}>\r\n                <div className={styles.itemTileThumbnail}>\r\n                  {/* <div className={styles.image}> */}\r\n                  <Image src={item.fileUrl} width={this._columnWidth} height={this._rowHeight} imageFit={ImageFit.cover} />\r\n                  {/* </div> */}\r\n                </div>\r\n                <div className={styles.itemTileCheckCircle}\r\n                  role='checkbox'\r\n                  aria-checked={isSelected}\r\n                  data-item-index={index} data-selection-toggle={true} data-automationid='CheckCircle'>\r\n                  <Check checked={isSelected} />\r\n                </div>\r\n                <div className={styles.itemTileNamePlate}>\r\n                  <div className={styles.itemTileName}>{item.name}</div>\r\n                  <div className={styles.itemTileSubText}>\r\n                    <span>{strings.EditedByNamePlate}{item.editedBy}</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Gets called what a file is selected.\r\n   */\r\n  private _handleItemInvoked = (item: IRecentFile) => {\r\n    this._selection.setKeySelected(item.key, true, true);\r\n  }\r\n\r\n  /**\r\n   * Gets called when it is time to save the currently selected item\r\n   */\r\n  private _handleSave = () => {\r\n    this.props.onSave(this.state.filePickerResult);\r\n  }\r\n\r\n  /**\r\n   * Gets called when it is time to close (without saving)\r\n   */\r\n  private _handleClose = () => {\r\n    this.props.onClose();\r\n  }\r\n\r\n  /**\r\n   * Creates a ref to the list\r\n   */\r\n  private _linkElement = (e: any) => {\r\n    this._listElem = e;\r\n  }\r\n}\r\n"],"sourceRoot":"..\\..\\..\\..\\src"}