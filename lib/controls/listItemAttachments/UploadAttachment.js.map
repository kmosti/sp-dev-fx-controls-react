{"version":3,"sources":["controls/listItemAttachments/UploadAttachment.tsx"],"names":[],"mappings":"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","file":"controls/listItemAttachments/UploadAttachment.js","sourcesContent":["import * as React from 'react';\r\nimport { Dialog, DialogType, DialogFooter } from 'office-ui-fabric-react/lib/Dialog';\r\nimport { PrimaryButton, } from 'office-ui-fabric-react/lib/Button';\r\nimport { IUploadAttachmentProps } from './IUploadAttachmentProps';\r\nimport { IUploadAttachmentState } from './IUploadAttachmentState';\r\nimport SPservice from \"../../services/SPService\";\r\nimport * as strings from 'ControlStrings';\r\nimport { CommandBar } from 'office-ui-fabric-react/lib/CommandBar';\r\nimport { ProgressIndicator } from 'office-ui-fabric-react/lib/ProgressIndicator';\r\nimport { createRef } from '@uifabric/utilities/lib';\r\nimport styles from './ListItemAttachments.module.scss';\r\n\r\nexport class UploadAttachment extends React.Component<IUploadAttachmentProps, IUploadAttachmentState> {\r\n  private _spservice: SPservice;\r\n  private fileInput;\r\n\r\n  constructor(props: IUploadAttachmentProps) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      file: null,\r\n      hideDialog: true,\r\n      dialogMessage: '',\r\n      isLoading: false,\r\n    };\r\n\r\n    // Get SPService\r\n    this._spservice = new SPservice(this.props.context);\r\n    this.fileInput = createRef();\r\n  }\r\n\r\n  /**\r\n   * componentDidUpdate lifecycle hook\r\n   *\r\n   * @param prevProps\r\n   * @param prevState\r\n   */\r\n  public componentDidUpdate(prevProps: IUploadAttachmentProps, prevState: IUploadAttachmentState): void {\r\n    if (this.props.fireUpload) {\r\n      this.fileInput.current.value = '';\r\n      this.fileInput.current.click();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * On attachment upload event\r\n   */\r\n  private onAttachmentUpload = () => {\r\n    // fire click event\r\n    this.fileInput.current.value = '';\r\n    this.fileInput.current.click();\r\n  }\r\n\r\n  /**\r\n   * Add a new attachment\r\n   */\r\n  private addAttachment = (e: React.ChangeEvent<HTMLInputElement>) =>{\r\n    this.setState({\r\n      isLoading: true\r\n    });\r\n\r\n    const reader = new FileReader();\r\n    const file = e.target.files[0];\r\n\r\n    reader.onloadend = async () => {\r\n      this.setState({\r\n        file: file\r\n      });\r\n\r\n      try {\r\n        await this._spservice.addAttachment(this.props.listId, this.props.itemId, file.name, file, this.props.webUrl);\r\n\r\n        this.setState({\r\n          isLoading: false\r\n        });\r\n        this.props.onAttachmentUpload();\r\n      } catch (error) {\r\n        this.setState({\r\n          hideDialog: false,\r\n          isLoading: false,\r\n          dialogMessage: strings.ListItemAttachmentsuploadAttachmentErrorMsg.replace('{0}', file.name).replace('{1}', error.message)\r\n        });\r\n      }\r\n    };\r\n    reader.readAsDataURL(file);\r\n  }\r\n\r\n  /**\r\n   * Close dialog\r\n   */\r\n  private closeDialog = () => {\r\n    this.setState({\r\n      hideDialog: true,\r\n      dialogMessage: '',\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Default React render method\r\n   */\r\n  public render() {\r\n    return (\r\n      <div>\r\n        <input id=\"file-picker\"\r\n               style={{ display: 'none' }}\r\n               type=\"file\"\r\n               onChange={(e) => this.addAttachment(e)}\r\n               ref={this.fileInput} />\r\n        <div className={styles.uploadBar}>\r\n          <CommandBar\r\n            items={[{\r\n              key: 'Add',\r\n              name: strings.ListItemAttachmentsCommandBarAddAttachmentLabel,\r\n              iconProps: {\r\n                iconName: 'Upload'\r\n              },\r\n              onClick: this.onAttachmentUpload,\r\n              disabled: this.props.disabled\r\n            }]}\r\n          />\r\n        </div>\r\n        <div>\r\n          {\r\n            this.state.isLoading ? <ProgressIndicator label={strings.ListItemAttachmentsloadingMessage} /> : \"\"\r\n          }\r\n        </div>\r\n        <Dialog\r\n          hidden={this.state.hideDialog}\r\n          type={DialogType.normal}\r\n          onDismiss={this.closeDialog}\r\n          dialogContentProps={{\r\n            type: DialogType.normal,\r\n            title: strings.ListItemAttachmentsuploadAttachmentDialogTitle,\r\n            subText: this.state.dialogMessage\r\n          }}\r\n          modalProps={{\r\n            isBlocking: true,\r\n            containerClassName: 'ms-dialogMainOverride'\r\n          }} >\r\n          <DialogFooter>\r\n            <PrimaryButton onClick={this.closeDialog}>OK</PrimaryButton>\r\n          </DialogFooter>\r\n        </Dialog>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"],"sourceRoot":"..\\..\\..\\src"}